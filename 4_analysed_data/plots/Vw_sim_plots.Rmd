---
title: "Vw_sim_plots"
author: "Manas GA"
date: "2024-12-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(ggplot2)
library(cowplot)
library(latex2exp)
```

## Function to make "standard" plot

```{r}
make_std_plots = function(data, font_size = 15, end_gen = 25000){
  
  # vA_est ~ vA_true

p_main = ggplot(data, aes(y = vA_est, x = vA_true)) + 
  theme_bw() + 
  geom_point() +
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)")) + 
  theme(text = element_text(size = font_size)) 
  
# palpha_est histogram

p_palpha = ggplot(data, aes(x = palpha_est)) + 
  theme_bw() + 
  geom_histogram(color = "black", fill = "white") + 
  labs(x = TeX(r"(Estimate of $p_{\alpha} $)"), y = "Frequency") + 
  geom_vline(xintercept = 0, color = "red") +  
  geom_vline(xintercept = mean(data$palpha_est), linetype = "dashed") +
  theme(text = element_text(size = font_size)) 

# balpha_intercept_est histogram

p_balpha_int = ggplot(data, aes(x = balpha_intercept_est)) + 
  theme_bw() + 
  geom_histogram(color = "black", fill = "white") + 
  labs(x = TeX(r"(Estimate of $\beta^{(0)}_{\bar{\alpha}}$)"), y = "Frequency") + 
  geom_vline(xintercept = 0, color = "red") + 
  geom_vline(xintercept = mean(data$balpha_intercept_est), linetype = "dashed") +
  theme(text = element_text(size = font_size)) 

# balpha_slope_est histogram

p_balpha_slope = ggplot(data, aes(x = balpha_slope_est)) + 
  theme_bw() + 
  geom_histogram(color = "black", fill = "white") + 
  labs(x = TeX(r"(Estimate of $\beta^{(1)}_{\bar{\alpha}}$)"), y = "Frequency") + 
  geom_vline(xintercept = 0, color = "red") + 
  geom_vline(xintercept = mean(data$balpha_slope_est), linetype = "dashed") +
  theme(text = element_text(size = font_size))

# Combine the four plots

p_combined = plot_grid(p_main, p_palpha, p_balpha_int, p_balpha_slope, labels = "AUTO")

# Title

ml = unique(data$sequence_length*data$r)
if(length(ml)>1){stop("The data set does not have the same map length in the burnin phase in every simulation.")}

ml_expt = unique(data$sequence_length*data$r_expt)
if(length(ml_expt)>1){stop("The data set does not have the same map length in the experiment in every simulation.")}

end_gen = unique(data$end_gen)
if(length(end_gen)>1){stop("The data doe not have have the same end_gen for every simulations")}

if(end_gen==2){
  ml = unique(data$sequence_length*data$r_msp)
  if(length(ml)>1){stop("The data set does not have the same map length in the burnin phase in every simulation.")}
}else{
  ml = unique(data$sequence_length*data$r)
  if(length(ml)>1){stop("The data set does not have the same map length in the burnin phase in every simulation.")}
}

title = ggdraw() + draw_label(paste("Map length in burnin = ", ml, " M, Map length in experiment = ", ml_expt, " M", sep = ""), hjust = 0.5, size = font_size)

# Add title
p_combined = plot_grid(title, p_combined, ncol = 1, rel_heights = c(0.1,1))
  

return(list(main = p_main, palpha = p_palpha, balpha_int = p_balpha_int, balpha_slope = p_balpha_slope,
            combined = p_combined))

  
}
```

## Simulations without burnin

Selection coefficients were drawn from a gamma distribution (shape = 0.3, scale = 0.033) and assigned to mutations randomly. The recombination rate in the msprime simulation was 5.32e-07. Map length in the burnin phase of just 1 generation (eng_gen = 2) was 25.

### Small map length in the experiment 

Standard parameters:

Map length in the experiment phase (ml_exp) = 0.1 M
Number of individuals in the experiment (n_ind_exp) = 1000
Number of cages (n_cages) = 10
ngen2 = 4



```{r}

d_0 = read.csv("../combined_data/Set_0_output.csv") # Data for the standard set
d_2 = read.csv("../combined_data/Set_2_output.csv") # Varying r_expt, n_ind_exp, n_cages, ngen2

d_nb_0.1  = rbind(d_0, d_2)

##################################################################################################
####### Standard plots (Set_0: ml_expt = 0.1, n_indxpt = 1000, n_cages = 10, ngen2 = 4) ##########
##################################################################################################

p_nb_0.1_std = make_std_plots(d_0)

ggsave(p_nb_0.1_std$combined, width = 8, height = 8, file = "p_nb_0.1_std.jpg")
p_nb_0.1_std$combined

```

We then vary ml_expt, n_ind_exp, n_cages, and ngen2 one at a time while keeping the other parameters fixed at their standard values.

```{r}
### ml_expt ###

d_nb_0.1_ml = d_nb_0.1[d_nb_0.1$n_ind_exp==1000&d_nb_0.1$n_cages==10&d_nb_0.1$ngen2==4,]
p_nb_0.1_ml = ggplot(d_nb_0.1_ml , aes(y=vA_est, x = vA_true, color = factor(sequence_length*r_expt))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Map length (M)") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE)

### n_ind_exp ###
d_nb_0.1_nind = d_nb_0.1[d_nb_0.1$r_exp==1e-7&d_nb_0.1$n_cages==10&d_nb_0.1$ngen2==4,]
p_nb_0.1_nind = ggplot(d_nb_0.1_nind , aes(y=vA_est, x = vA_true, color = factor(n_ind_exp))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Population size") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) 

### n_cages ###

d_nb_0.1_ncages = d_nb_0.1[d_nb_0.1$r_exp==1e-7&d_nb_0.1$n_ind_exp==1000&d_nb_0.1$ngen2==4,]
p_nb_0.1_ncages = ggplot(d_nb_0.1_ncages , aes(y=vA_est, x = vA_true, color = factor(n_cages))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Replicate \npopulations") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) 

### ngen_expt ###

d_nb_0.1_ngen2 = d_nb_0.1[d_nb_0.1$r_exp==1e-7&d_nb_0.1$n_ind_exp==1000&d_nb_0.1$n_cages==10,]
p_nb_0.1_ngen2 = ggplot(d_nb_0.1_ngen2 , aes(y=vA_est, x = vA_true, color = factor(ngen2-ngen1))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Generations") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) 

p_nb_0.1_combined = plot_grid(p_nb_0.1_ml, p_nb_0.1_nind, p_nb_0.1_ncages, p_nb_0.1_ngen2, labels = "AUTO")

p_nb_0.1_combined
ggsave(p_nb_0.1_combined, width = 12, height = 8, file = "p_nb_0.1_combined.jpg")

```

### Set_5: Larger map length in the experiment (standard value = 2 M)

Not varying the map length in burnin (fixed to 5 M)

```{r}
d_5 = read.csv("../combined_data/Set_5_output.csv")
d_5_std = d_5[d_5$r_expt*d_5$sequence_length==2&d_5$n_ind_exp==1000&d_5$n_cages==10&d_5$ngen2==4,] # Data for the standard set

##################################################################################################
####### Standard plots (Set_0: ml_expt = 2, n_indxpt = 1000, n_cages = 10, ngen2 = 4) ############
##################################################################################################

p_nb_2_std = make_std_plots(d_5_std)

ggsave(p_nb_2_std$combined, width = 8, height = 8, file = "p_nb_2_std.jpg")
p_nb_2_std$combined


```

We then vary ml_expt, n_ind_exp, n_cages, and ngen2 one at a time while keeping the other parameters fixed at their standard values.
```{r}
### ml_expt ###

d_5_ml = d_5[d_5$n_ind_exp==1000&d_5$n_cages==10&d_5$ngen2==4,]
p_nb_2_ml = ggplot(d_5_ml , aes(y=vA_est, x = vA_true, color = factor(sequence_length*r_expt))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Map length (M)") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE)

### n_ind_exp ###
d_5_nind = d_5[d_5$r_exp==2e-6&d_5$n_cages==10&d_5$ngen2==4,]
p_nb_2_nind = ggplot(d_5_nind , aes(y=vA_est, x = vA_true, color = factor(n_ind_exp))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Population size") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) 

### n_cages ###

d_5_ncages = d_5[d_5$r_exp==2e-6&d_5$n_ind_exp==1000&d_5$ngen2==4,]
p_nb_2_ncages = ggplot(d_5_ncages , aes(y=vA_est, x = vA_true, color = factor(n_cages))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Replicate \npopulations") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) 

### ngen_expt ###

d_5_ngen2 = d_5[d_5$r_exp==2e-6&d_5$n_ind_exp==1000&d_5$n_cages==10,]
p_nb_2_ngen2 = ggplot(d_5_ngen2 , aes(y=vA_est, x = vA_true, color = factor(ngen2-ngen1))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Generations") + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) 

p_nb_2_combined = plot_grid(p_nb_2_ml, p_nb_2_nind, p_nb_2_ncages, p_nb_2_ngen2, labels = "AUTO")

p_nb_2_combined
ggsave(p_nb_2_combined, width = 12, height = 8, file = "p_nb_2_combined.jpg")
```



## Simulations with burnin

### Set 1 (ml = 25, ml_exp = 0.1)

```{r}
d_1 = read.csv("../combined_data/Set_1_output.csv")
p_b_25_0.1_std = make_std_plots(d_1)
ggsave(p_b_25_0.1_std$combined, width = 8, height = 8, file = "p_b_25_0.1_std.jpg")
p_b_25_0.1_std$combined
```
### Set 3 (ml = 25, ml_exp = 15)

```{r}
d_3 = read.csv("../combined_data/Set_3_output.csv")
p_b_25_15_std = make_std_plots(d_3)
ggsave(p_b_25_15_std$combined, width = 8, height = 8, file = "p_b_25_15_std.jpg")
p_b_25_15_std$combined
```
### Set 4 (ml = 5, ml_exp = 15)
```{r}
d_4 = read.csv("../combined_data/Set_4_output.csv")
p_b_5_15_std = make_std_plots(d_4)
ggsave(p_b_5_15_std$combined, width = 8, height = 8, file = "p_b_5_15_std.jpg")
p_b_5_15_std$combined
```

### Set 6 (varying ml_exp: 0.01, 0.2, 2 (reference)) and 7 (varying ml: 0.5, 5 (reference), 50)

```{r}
d_6 = read.csv("../combined_data/Set_6_output.csv")
d_6_std = d_6[d_6$r*d_6$sequence_length==5&d_6$r_exp*d_6$sequence_length==2,]
p_b_5_2_std = make_std_plots(d_6_std)
ggsave(p_b_5_2_std$combined, width = 8, height = 8, file = "p_b_5_2_std.jpg")
p_b_5_2_std$combined

### ml_expt ###

p_b_5_2_ml_exp = ggplot(d_6 , aes(y=vA_est, x = vA_true, color = factor(sequence_length*r_expt))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Map length (M)", title = paste("Map length in burnin = ", unique(d_6$sequence_length*d_6$r), " M", sep = "")) + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) +
  theme(plot.title = element_text(hjust = 0.5))

ggsave(p_b_5_2_ml_exp, width = 8, height = 8, file = "p_b_5_2_ml_exp.jpg")
p_b_5_2_ml_exp

d_7 = read.csv("../combined_data/Set_7_output.csv")

d_7_std = d_7[d_7$r==5e-7,]

p_b_0.5_2_std = make_std_plots(d_7_std)
ggsave(p_b_0.5_2_std$combined, width = 8, height = 8, file = "p_b_0.5_2_std.jpg")
p_b_0.5_2_std$combined

d_7_ml = rbind(d_7, d_6_std)

### ml ###

p_b_5_2_ml = ggplot(d_7_ml , aes(y=vA_est, x = vA_true, color = factor(sequence_length*r))) +
  theme_bw() + 
  geom_point() + 
  geom_abline(intercept = 0, slope = 1) + 
  labs(x = TeX(r"(True $V_A$)"), y = TeX(r"(Estimate of $V_A$)"), color = "Map length (M)", title = paste("Map length in experiment = ", unique(d_7_ml$sequence_length*d_6$r_exp), " M", sep = "")) + 
  scale_color_manual(values = c("#0072B2", "#999999", "#009E73")) + 
  theme(text = element_text(size = 15)) +
  geom_smooth(method = "lm", se=FALSE) +
  theme(plot.title = element_text(hjust = 0.5))

ggsave(p_b_5_2_ml, width = 8, height = 8, file = "p_b_5_2_ml.jpg")
p_b_5_2_ml


```
### Set 8 (larger simulations (scale = 0.033): ml = 0.5, ml_exp = 2)
```{r}
d_8 = read.csv("../combined_data/Set_8_output.csv") # Data for the standard set

p_b_large_std = make_std_plots(d_8)
ggsave(plot = p_b_large_std$combined, width = 8, height = 8, file = "p_b_large_0.5_2_ml.jpg")
p_b_large_std$combined

```

